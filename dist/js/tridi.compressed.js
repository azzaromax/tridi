/*
  Tridi
  license: MIT
  homepage: https://tridi.lukem.net
  github: http://github.com/lukemnet/tridi
*/
var Tridi=function(){function r(e){this.validateOptions=function(e){e.element||console.error(r.header(),"'element' property is missing or invalid. Container element must be specified."),void 0===e.images&&void 0===e.imageFormat&&console.error(r.header(),"'imageFormat' property is missing or invalid. Image format must be provided for 'numbered' property."),"numbered"!==e.images||e.imageLocation||console.error(r.header(),"'imageLocation' property is missing or invalid. Image location must be provided for 'numbered' property."),Array.isArray(e.images)&&e.imageFormat&&console.warn(r.header(),"Got array of images as initalizing parameter. 'imageFormat' property will be ignored."),Array.isArray(e.images)&&e.imageLocation&&console.warn(r.header(),"Got array of images as initalizing parameter. 'imageLocation' property will be ignored."),Array.isArray(e.images)&&e.imageCount&&console.warn(r.header(),"Got array of images as initalizing parameter. 'imageCount' property will be ignored."),!e.draggable&&e.mouseleaveDetect&&console.warn(r.header(),"'draggable is set to 'false'. 'mouseleaveDetect' parameter will be ignored."),!e.autoplay&&e.autoplaySpeed&&console.warn(r.header(),"'autoplay is set to 'false'. 'autoplaySpeed' parameter will be ignored."),!e.autoplay&&e.stopAutoplayOnMouseenter&&console.warn(r.header(),"'autoplay is set to 'false'. 'stopAutoplayOnMouseenter' parameter will be ignored."),!e.autoplay&&e.resumeAutoplayOnMouseleave&&console.warn(r.header(),"'autoplay is set to 'false'. 'resumeAutoplayOnMouseleave' parameter will be ignored."),!e.autoplay&&e.resumeAutoplayDelay&&console.warn(r.header(),"'autoplay is set to 'false'. 'resumeAutoplayDelay' parameter will be ignored.")},this.validateOptions(e),this.element=e.element,this.images=e.images||"numbered",this.imageFormat=e.imageFormat||void 0,this.imageLocation=e.imageLocation||"./images",this.imageCount=Array.isArray(this.images)?this.images.length:e.imageCount||e.imagecount||e.count,this.draggable=void 0===e.draggable||e.draggable,this.autoplay=e.autoplay||!1,this.autoplaySpeed=void 0!==e.autoplaySpeed?e.autoplaySpeed||e.autoplayspeed:50,this.stopAutoplayOnClick=e.stopAutoplayOnClick||!1,this.stopAutoplayOnMouseenter=e.stopAutoplayOnMouseenter||!1,this.resumeAutoplayOnMouseleave=e.resumeAutoplayOnMouseleave||!1,this.resumeAutoplayDelay=e.resumeAutoplayDelay||0,this.buttons=e.buttons||!1,this.scroll=e.scroll||!1,this.touch=void 0===e.touch||e.touch,this.mousewheel=e.mousewheel||!1,this.inverse=e.inverse||!1,this.dragInterval=e.dragInterval||1,this.touchDragInterval=e.touchDragInterval||1,this.mouseleaveDetect=void 0!==e.mouseleaveDetect&&e.mouseleaveDetect,this.verbose=e.verbose||e.debug||!1,this.imageIndex=1,this.moveBuffer=[],this.moveState=0,this.dragActive=!1,this.intervals=[],this.timeouts=[],this.verbose&&console.log(r.header(this.element),"Class intialized")}return r.header=function(e){return"Tridi"+(e?" ["+e+"]":"")+":"},r.prototype.appendClass=function(e,t){e.className+=0===e.className.length?t:" "+t},r.prototype.addClassName=function(t,e){var o=this;"string"==typeof e?t.classList.contains(e)||this.appendClass(t,e):Array.isArray(e)&&e.forEach(function(e){t.classList.contains(e)||o.appendClass(t,e)})},r.prototype.removeClassName=function(t,e){"string"==typeof e?t.classList.contains(e)&&t.classList.remove(e):Array.isArray(e)&&e.forEach(function(e){t.classList.contains(e)&&t.classList.remove(e)})},r.prototype.getContainer=function(){return document.querySelector(this.element)},r.prototype.getViewer=function(){return document.querySelector(this.element+".tridi-viewer")},r.prototype.getStash=function(){return document.querySelector(this.element+" .tridi-stash")},r.prototype.getLeftButton=function(){return document.querySelector(this.element+" .tridi-btn-left")},r.prototype.getRightButton=function(){return document.querySelector(this.element+" .tridi-btn-right")},r.prototype.getImages=function(){if("numbered"!==this.images)return Array.isArray(this.images)?this.images:(console.error(r.header(this.element),"Error getting images from source."),null);var e=this.imageCount,o=this.imageLocation,i=this.imageFormat;return Array.from(new Array(e),function(e,t){return o+"/"+(t+1)+"."+i})},r.prototype.generateViewer=function(){var e=this.getContainer();e?(this.verbose&&console.log(r.header(this.element),"Appending Tridi CSS classes"),this.addClassName(e,["tridi-viewer","tridi-viewer-"+this.element.substr(1),"tridi-draggable-"+this.draggable,"tridi-touch-"+this.touch,"tridi-mousewheel-"+this.mousewheel,"tridi-buttons-"+this.buttons])):console.error(this.element,"Viewer element not found")},r.prototype.generateStash=function(){if(this.getStash())console.error("Error generating stash!");else{this.verbose&&console.log(r.header(this.element),"Generating image stash");var e=document.createElement("div");e.className="tridi-stash",e.style.cssText="display: none;",this.getViewer().appendChild(e)}},r.prototype.populateStash=function(){var t=this.getStash(),e=this.getImages();t&&e?e.forEach(function(e){t.innerHTML+='<img src="'+e+'" alt="" />'}):console.error(this.element,"Error populating stash!")},r.prototype.getImage=function(e){return this.getImages()[e-1]},r.prototype.getFirstImage=function(){return this.getImage(1)},r.prototype.generateViewerImage=function(){this.verbose&&console.log(r.header(this.element),"Generating first image");var e=this.getViewer(),t=this.getFirstImage();e.innerHTML='<img src="'+t+'" alt="" class="tridi-viewer-image" draggable="false" />'+e.innerHTML},r.prototype.getViewerImage=function(){return document.querySelector(this.element+".tridi-viewer .tridi-viewer-image")},r.prototype.nextFrame=function(){var e=this.getViewerImage();this.imageIndex=this.imageIndex<=1?this.imageCount:this.imageIndex-1,e.src=this.getImage(this.imageIndex)},r.prototype.previousFrame=function(){var e=this.getViewerImage();this.imageIndex=this.imageIndex>=this.imageCount?1:this.imageIndex+1,e.src=this.getImage(this.imageIndex)},r.prototype.rotateViewerImage=function(e){var t=this,o=e.touches?this.touchDragInterval:this.dragInterval;this.moveState+=1;var i=(e.touches?e.touches[0].clientX:e.clientX)-this.getViewerImage().offsetLeft;this.moveBuffer.push(i);var r=this.moveBuffer.length,s=this.moveBuffer[r-2],a=this.moveBuffer[r-1];!(this.moveState%o)&&(a<s?t.inverse?t.previousFrame():t.nextFrame():s<a&&(t.inverse?t.nextFrame():t.previousFrame()))},r.prototype.startDragging=function(){var e=this.getViewer();this.addClassName(e,"tridi-dragging"),this.dragActive=!0},r.prototype.stopDragging=function(){var e=this.getViewer();this.removeClassName(e,"tridi-dragging"),this.dragActive=!1},r.prototype.resetMoveBuffer=function(){this.moveBuffer=[]},r.prototype.attachCosmeticEvents=function(){var e=this;this.verbose&&console.log(r.header(this.element),"Attaching common events");var t=this.getViewer();t.addEventListener("mouseenter",function(){e.verbose&&console.log(r.header(e.element),"Mouseenter event triggered"),e.addClassName(t,"tridi-viewer-hovered")}),t.addEventListener("mouseleave",function(){e.verbose&&console.log(r.header(e.element),"Mouseenter event triggered"),e.removeClassName(t,"tridi-viewer-hovered")})},r.prototype.attachDragEvents=function(){var t=this;if(this.draggable){var e=this.getViewerImage();this.verbose&&console.log(r.header(this.element),"Attaching drag events"),e.addEventListener("mouseup",function(){t.verbose&&console.log(r.header(t.element),"Mouseup triggered"),t.stopDragging(),t.resetMoveBuffer()}),e.addEventListener("mousedown",function(e){t.verbose&&console.log(r.header(t.element),"Mousedown triggered"),t.startDragging(),t.rotateViewerImage(e)}),e.addEventListener("mousemove",function(e){t.dragActive&&(t.verbose&&console.log(r.header(t.element),"Mousemove triggered"),t.rotateViewerImage(e))}),e.addEventListener("mouseleave",function(){t.verbose&&console.log(r.header(t.element),"Mouseleave triggered"),t.resetMoveBuffer()})}},r.prototype.attachMouseLeaveDetection=function(){var e=this;this.mouseleaveDetect&&(this.verbose&&console.log(r.header(this.element),"Attaching mouseleave detection"),this.getViewer().addEventListener("mouseleave",function(){e.verbose&&console.log(r.header(e.element),"Viewer mouseleave triggered"),e.stopDragging(),e.resetMoveBuffer()}))},r.prototype.attachTouchEvents=function(){var t=this;if(this.touch){this.verbose&&console.log(r.header(this.element),"Attaching touch events");var e=this.getViewerImage();e.addEventListener("touchstart",function(e){t.verbose&&console.log(r.header(t.element),"Touchstart triggered"),t.startDragging(),t.rotateViewerImage(e)}),e.addEventListener("touchmove",function(e){t.verbose&&console.log(r.header(t.element),"Touchmove triggered"),t.rotateViewerImage(e)}),e.addEventListener("touchend",function(){t.verbose&&console.log(r.header(t.element),"Touchend triggered"),t.stopDragging(),t.resetMoveBuffer()})}},r.prototype.attachMousewheelEvents=function(){var t=this;this.mousewheel&&(this.verbose&&console.log(r.header(this.element),"Attaching mousewheel events"),this.getViewerImage().addEventListener("wheel",function(e){e.preventDefault(),0<e.deltaY/120?t.nextFrame():t.previousFrame()}))},r.prototype.generateButtons=function(){if(this.buttons&&!this.getLeftButton()&&!this.getRightButton()){this.verbose&&console.log(r.header(this.element),"Generating buttons");var e=document.createElement("div"),t=document.createElement("div");e.className+="tridi-btn tridi-btn-left",e.setAttribute("tabindex","0"),t.className+="tridi-btn tridi-btn-right",t.setAttribute("tabindex","0"),this.getViewer().appendChild(e),this.getViewer().appendChild(t)}},r.prototype.attachButtonEvents=function(){var t=this;if(this.buttons){var e=this.getLeftButton(),o=this.getRightButton();e&&(this.verbose&&console.log(r.header(this.element),"Attaching left button click event"),e.addEventListener("click",function(){t.verbose&&console.log(r.header(t.element),"Left button click triggered"),t.inverse?t.previousFrame():t.nextFrame()}),e.addEventListener("keydown",function(e){13===e.which&&(t.verbose&&console.log(r.header(t.element),"Left button Enter keydown triggered"),t.inverse?t.previousFrame():t.nextFrame())})),o&&(this.verbose&&console.log(r.header(this.element),"Attaching right button click event"),o.addEventListener("click",function(){t.verbose&&console.log(r.header(t.element),"Right button click triggered"),t.inverse?t.nextFrame():t.previousFrame()}),o.addEventListener("keydown",function(e){13===e.which&&(t.verbose&&console.log(r.header(t.element),"Right button Enter keydown triggered"),t.inverse?t.nextFrame():t.previousFrame())}))}},r.prototype.toggleAutoplay=function(e,t){var o=this.resumeAutoplayDelay,i=this.autoplaySpeed;if(!1===e)this.intervals.forEach(clearInterval),this.intervals=[];else{var r=this;if(this.timeouts.forEach(clearTimeout),this.timeouts=[],t){var s=setInterval(function(){r.nextFrame()},i);r.intervals.push(s)}else{var a=setTimeout(function(){var e=setInterval(function(){r.nextFrame()},i);r.intervals.push(e)},o);r.timeouts.push(a)}}},r.prototype.startAutoplay=function(){var t=this;if(this.autoplay){if(this.verbose&&console.log(r.header(this.element),"Starting autoplay"),this.toggleAutoplay(!0,!0),this.stopAutoplayOnClick)this.verbose&&console.log(r.header(this.element),"Enable stop autoplay on click event"),this.getViewerImage().addEventListener("mousedown",function(){t.toggleAutoplay(!1)});if(this.stopAutoplayOnMouseenter)this.verbose&&console.log(r.header(this.element),"Enable stop autoplay on hover event"),this.getViewerImage().addEventListener("mouseenter",function(){t.verbose&&console.log(r.header(t.element),"Stopping autoplay on mouseenter"),t.toggleAutoplay(!1)});if(this.resumeAutoplayOnMouseleave)this.getViewerImage().addEventListener("mouseleave",function(e){t.verbose&&console.log(r.header(t.element),"Resuming autoplay on mouseleave"),e.toElement.classList.contains("tridi-btn")||t.toggleAutoplay(!0)})}},r.prototype.start=function(){this.generateViewer(),this.generateStash(),this.populateStash(),this.generateViewerImage(),this.attachCosmeticEvents(),this.attachDragEvents(),this.attachMouseLeaveDetection(),this.attachTouchEvents(),this.attachMousewheelEvents(),this.generateButtons(),this.attachButtonEvents(),this.startAutoplay()},r.prototype.load=function(){this.start()},r}();