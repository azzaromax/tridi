/*
  Tridi v0.0.5 - 360 3D Product Viewer
  Author: Łukasz Wójcik
  License: MIT
  Homepage: https://tridi.lukem.net
  GitHub: http://github.com/lukemnet/tridi
*/
var Tridi=function(){function t(t){this.validate=function(t){t.element||console.error("'element' property is missing or invalid. Container element must be specified."),void 0===t.images&&void 0===t.imageFormat&&console.error("'imageFormat' property is missing or invalid. Image format must be provided for 'numbered' property."),"numbered"!==t.images||t.imageLocation||console.error("'imageLocation' property is missing or invalid. Image location must be provided for 'numbered' property.")},this.validate(t),this.element=t.element,this.images=t.images||"numbered",this.imageFormat=t.imageFormat||void 0,this.imageLocation=t.imageLocation||"./images",this.imageCount=Array.isArray(this.images)?this.images.length:t.imageCount,this.draggable=void 0===t.draggable||t.draggable,this.showHintOnStartup=t.showHintOnStartup||!1,this.hintText=t.hintText||null,this.lazy=t.lazy||!1,this.autoplay=t.autoplay||!1,this.autoplaySpeed=void 0!==t.autoplaySpeed?t.autoplaySpeed:50,this.stopAutoplayOnClick=t.stopAutoplayOnClick||!1,this.stopAutoplayOnMouseenter=t.stopAutoplayOnMouseenter||!1,this.resumeAutoplayOnMouseleave=t.resumeAutoplayOnMouseleave||!1,this.resumeAutoplayDelay=t.resumeAutoplayDelay||0,this.buttons=t.buttons||!1,this.scroll=t.scroll||!1,this.spinner=t.spinner||!1,this.touch=void 0===t.touch||t.touch,this.mousewheel=t.mousewheel||!1,this.wheelInverse=t.wheelInverse||!1,this.inverse=t.inverse||!1,this.dragInterval=t.dragInterval||1,this.touchDragInterval=t.touchDragInterval||2,this.mouseleaveDetect=void 0!==t.mouseleaveDetect&&t.mouseleaveDetect,this.imageIndex=1,this.moveBuffer=[],this.dragActive=!1,this.intervals=[],this.timeouts=[]}return t.prototype.updateOption=function(t,e){this[t]=e},t.prototype.validateUpdate=function(t){return!!(t.images||t.imageFormat||t.imageCount||t.imageLocation)||(console.error("UpdatableOptions object doesn't contain options that can be updated."),!1)},t.prototype.updateOptions=function(e){var i=this;Object.keys(e).forEach(function(t){i.updateOption(t,e[t])})},t.prototype.getElem=function(t,e){return document.querySelector(this.element+(e?" ":"")+(t||""))},t.prototype.container=function(){return this.getElem()},t.prototype.viewer=function(){return this.getElem(".tridi-viewer")},t.prototype.stash=function(){return this.getElem(".tridi-stash",!0)},t.prototype.leftBtn=function(){return this.getElem(".tridi-btn-left",!0)},t.prototype.rightBtn=function(){return this.getElem(".tridi-btn-right",!0)},t.prototype.getHintOverlay=function(){return this.getElem(".tridi-hint-overlay",!0)},t.prototype.getLoadingScreen=function(){return this.getElem(".tridi-loading",!0)},t.prototype.image=function(t){return this.imgs()[t-1]},t.prototype.firstImage=function(){return this.image(1)},t.prototype.viewerImage=function(){return this.getElem(".tridi-viewer .tridi-viewer-image")},t.prototype.lazyLoad=function(t,e){this.lazy&&!e?(this.viewerImage().addEventListener("click",t),this.touch&&this.viewerImage().addEventListener("touchstart",t)):t()},t.prototype.imgs=function(){if("numbered"!==this.images)return Array.isArray(this.images)?this.images:null;var t=this.imageCount,i=this.imageLocation,n=this.imageFormat;return Array.apply(null,{length:t}).map(function(t,e){return i+"/"+(e+1)+"."+n})},t.prototype.generateViewer=function(){var t=this.container();if(t){var e=this.element.substr(1);t.className+=" tridi-viewer tridi-"+e+"-viewer tridi-draggable-"+this.draggable+" tridi-touch-"+this.touch+" tridi-mousewheel-"+this.mousewheel+" tridi-showHintOnStartup-"+this.showHintOnStartup+" tridi-lazy-"+this.lazy+" tridi-buttons-"+this.buttons}},t.prototype.generateLoadingScreen=function(){var t=document.createElement("div");t.className="tridi-loading",t.style.display="none";var e=document.createElement("div");e.className="tridi-spinner",t.appendChild(e),this.viewer().appendChild(t)},t.prototype.setLoadingState=function(t){this.getLoadingScreen().style.display=t?"block":"none"},t.prototype.generateStash=function(){if(!this.stash()){var t=document.createElement("div");t.classList.add("tridi-stash"),this.viewer().appendChild(t)}},t.prototype.destroyStash=function(){this.stash()&&this.stash().remove()},t.prototype.displayHintOnStartup=function(n){var a=this;if(this.showHintOnStartup){var t=this.element.substr(1),r="tridi-"+t+"-hint-overlay",e=document.createElement("div");e.className+="tridi-hint-overlay "+r,e.tabIndex=0;var s="tridi-"+t+"-hint",i=document.createElement("div");i.className+="tridi-hint "+s,this.hintText&&(i.innerHTML='<span class="tridi-hint-text">'+this.hintText+"</span>"),e.appendChild(i),this.viewer().appendChild(e);var o=function(t){var e=t.target.classList.contains(r),i=t.target.classList.contains(s);(e||i)&&(a.getHintOverlay().style.display="none",n())};document.addEventListener("click",o),this.touch&&document.addEventListener("touchstart",o),document.addEventListener("keydown",function(t){13===t.which&&o(t)})}else n()},t.prototype.populateStash=function(){var i=this.stash(),t=this.imgs();i&&t&&t.forEach(function(t,e){i.innerHTML+='<img src="'+t+'" class="tridi-image tridi-image-'+(e+1)+'" alt="" />'})},t.prototype.generateViewerImage=function(){var t=this.viewer(),e=this.firstImage();t.innerHTML='<img src="'+e+'" alt="" class="tridi-viewer-image" draggable="false" />'+t.innerHTML},t.prototype.updateViewerImage=function(t){this.viewerImage().src=t?this.image(t):this.firstImage()},t.prototype.nextMove=function(){return this.inverse?this.prevFrame():this.nextFrame()},t.prototype.prevMove=function(){return this.inverse?this.nextFrame():this.prevFrame()},t.prototype.nextFrame=function(){var t=this.viewerImage();this.imageIndex=this.imageIndex<=1?this.imageCount:this.imageIndex-1,t.src=this.image(this.imageIndex)},t.prototype.prevFrame=function(){var t=this.viewerImage();this.imageIndex=this.imageIndex>=this.imageCount?1:this.imageIndex+1,t.src=this.image(this.imageIndex)},t.prototype.rotateViewerImage=function(t){var e=t.touches?this.touchDragInterval:this.dragInterval,i=(t.touches?t.touches[0].clientX:t.clientX)-this.viewerImage().offsetLeft;if(this.moveBuffer.length<2)this.moveBuffer.push(i);else{var n=this.moveBuffer[1];this.moveBuffer[1]=i,this.moveBuffer[0]=n}var a=!(i%e),r=this.moveBuffer[0],s=this.moveBuffer[1];a&&(s<r?this.nextMove():r<s&&this.prevMove())},t.prototype.startDragging=function(){this.dragActive=!0},t.prototype.stopDragging=function(){this.dragActive=!1},t.prototype.resetMoveBuffer=function(){this.moveBuffer.length=0},t.prototype.attachCosmeticEvents=function(){var t=this.viewer(),e=function(){return t.classList.toggle("tridi-viewer-hovered")};t.addEventListener("mouseenter",e),t.addEventListener("mouseleave",e)},t.prototype.attachDragEvents=function(){var e=this;if(this.draggable){var t=this.viewerImage();t.addEventListener("mousedown",function(t){t.preventDefault&&t.preventDefault(),e.startDragging(),e.rotateViewerImage(t)}),t.addEventListener("mouseup",function(t){t.preventDefault&&t.preventDefault(),e.stopDragging(),e.resetMoveBuffer()}),t.addEventListener("mousemove",function(t){e.dragActive&&e.rotateViewerImage(t)}),t.addEventListener("mouseleave",function(){e.resetMoveBuffer()})}},t.prototype.attachMouseLeaveDetection=function(){var t=this;this.mouseleaveDetect&&this.viewer().addEventListener("mouseleave",function(){t.stopDragging(),t.resetMoveBuffer()})},t.prototype.attachTouchEvents=function(){var e=this;if(this.touch){var t=this.viewerImage();t.addEventListener("touchstart",function(t){t.preventDefault&&t.preventDefault(),e.startDragging(),e.rotateViewerImage(t)}),t.addEventListener("touchmove",function(t){t.preventDefault&&t.preventDefault(),e.rotateViewerImage(t)}),t.addEventListener("touchend",function(t){t.preventDefault&&t.preventDefault(),e.stopDragging(),e.resetMoveBuffer()})}},t.prototype.attachMousewheelEvents=function(){var e=this;this.mousewheel&&this.viewerImage().addEventListener("wheel",function(t){t.preventDefault&&t.preventDefault(),0<t.deltaY/120?e.nextMove():e.prevMove()})},t.prototype.generateButton=function(t){var e=document.createElement("div");e.setAttribute("tabindex","0"),e.className+="tridi-btn tridi-btn-"+t,this.viewer().appendChild(e)},t.prototype.generateButtons=function(){this.buttons&&(this.leftBtn()||this.rightBtn()||(this.generateButton("left"),this.generateButton("right")))},t.prototype.attachButtonEvents=function(){var e=this;if(this.buttons){var t=this.leftBtn(),i=this.rightBtn();t&&(t.addEventListener("click",this.nextMove),t.addEventListener("keydown",function(t){13===t.which&&e.nextMove()})),i&&(i.addEventListener("click",this.prevMove),i.addEventListener("keydown",function(t){13===t.which&&e.prevMove()}))}},t.prototype.toggleAutoplay=function(t,e){var i=this,n=this.autoplaySpeed;if(t)if(this.timeouts.forEach(clearTimeout),this.timeouts.length=0,e){var a=window.setInterval(function(){i.nextFrame()},n);this.intervals.push(a)}else{var r=window.setTimeout(function(){var t=window.setInterval(function(){i.nextFrame()},n);i.intervals.push(t)},this.resumeAutoplayDelay);this.timeouts.push(r)}else this.intervals.forEach(clearInterval),this.intervals.length=0},t.prototype.startAutoplay=function(){var e=this;this.autoplay&&(this.toggleAutoplay(!0,!0),this.stopAutoplayOnClick&&this.viewerImage().addEventListener("mousedown",function(){e.toggleAutoplay(!1)}),this.stopAutoplayOnMouseenter&&this.viewerImage().addEventListener("mouseenter",function(){e.toggleAutoplay(!1)}),this.resumeAutoplayOnMouseleave&&this.viewerImage().addEventListener("mouseleave",function(t){t.target.classList.contains("tridi-btn")||e.toggleAutoplay(!0)}))},t.prototype.attachEvents=function(){this.attachCosmeticEvents(),this.attachDragEvents(),this.attachMouseLeaveDetection(),this.attachTouchEvents(),this.attachMousewheelEvents()},t.prototype.start=function(){var t=this;this.generateViewer(),this.generateLoadingScreen(),this.setLoadingState(!0),this.generateViewerImage(),this.setLoadingState(!1),this.displayHintOnStartup(function(){t.lazyLoad(function(){t.setLoadingState(!0),t.generateStash(),t.populateStash(),t.attachEvents(),t.generateButtons(),t.attachButtonEvents(),t.startAutoplay(),t.setLoadingState(!1)})})},t.prototype.update=function(t,e){this.validateUpdate(t)&&(this.setLoadingState(!0),this.updateOptions(t),this.destroyStash(),this.generateStash(),this.populateStash(),this.updateViewerImage(e?this.imageIndex:1),this.attachEvents(),this.setLoadingState(!1))},t.prototype.load=function(){this.start()},t}();